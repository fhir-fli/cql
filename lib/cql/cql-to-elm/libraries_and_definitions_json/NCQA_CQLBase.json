{
    "library": {
        "annotation": [
            {
                "translatorVersion": "2.11.0",
                "translatorOptions": "",
                "type": "CqlToElmInfo"
            }
        ],
        "identifier": {
            "id": "NCQA_CQLBase",
            "version": "1.0.0"
        },
        "schemaIdentifier": {
            "id": "urn:hl7-org:elm",
            "version": "r1"
        },
        "usings": {
            "def": [
                {
                    "localIdentifier": "System",
                    "uri": "urn:hl7-org:elm-types:r1"
                },
                {
                    "localIdentifier": "FHIR",
                    "uri": "http://hl7.org/fhir",
                    "version": "4.0.1"
                }
            ]
        },
        "statements": {
            "def": [
                {
                    "name": "Sort Date Intervals",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "If",
                        "condition": {
                            "type": "IsNull",
                            "operand": {
                                "name": "intervals",
                                "type": "OperandRef"
                            }
                        },
                        "then": {
                            "strict": false,
                            "type": "As",
                            "operand": {
                                "type": "List"
                            },
                            "asTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}Date",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        },
                        "else": {
                            "type": "If",
                            "condition": {
                                "type": "Equal",
                                "operand": [
                                    {
                                        "type": "Count",
                                        "source": {
                                            "name": "intervals",
                                            "type": "OperandRef"
                                        }
                                    },
                                    {
                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                        "value": "0",
                                        "type": "Literal"
                                    }
                                ]
                            },
                            "then": {
                                "strict": false,
                                "type": "As",
                                "operand": {
                                    "type": "List"
                                },
                                "asTypeSpecifier": {
                                    "type": "ListTypeSpecifier",
                                    "elementType": {
                                        "type": "IntervalTypeSpecifier",
                                        "pointType": {
                                            "name": "{urn:hl7-org:elm-types:r1}Date",
                                            "type": "NamedTypeSpecifier"
                                        }
                                    }
                                }
                            },
                            "else": {
                                "type": "Query",
                                "source": [
                                    {
                                        "alias": "sortedIntervals",
                                        "expression": {
                                            "type": "Query",
                                            "source": [
                                                {
                                                    "alias": "I",
                                                    "expression": {
                                                        "name": "intervals",
                                                        "type": "OperandRef"
                                                    }
                                                }
                                            ],
                                            "relationship": [],
                                            "return": {
                                                "expression": {
                                                    "type": "Tuple",
                                                    "element": [
                                                        {
                                                            "name": "interval",
                                                            "value": {
                                                                "name": "I",
                                                                "type": "AliasRef"
                                                            }
                                                        },
                                                        {
                                                            "name": "startOfInterval",
                                                            "value": {
                                                                "type": "If",
                                                                "condition": {
                                                                    "type": "IsNull",
                                                                    "operand": {
                                                                        "type": "Start",
                                                                        "operand": {
                                                                            "name": "I",
                                                                            "type": "AliasRef"
                                                                        }
                                                                    }
                                                                },
                                                                "then": {
                                                                    "valueType": "{urn:hl7-org:elm-types:r1}Date",
                                                                    "type": "MinValue"
                                                                },
                                                                "else": {
                                                                    "type": "Start",
                                                                    "operand": {
                                                                        "name": "I",
                                                                        "type": "AliasRef"
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            "sort": {
                                                "by": [
                                                    {
                                                        "direction": "asc",
                                                        "path": "startOfInterval",
                                                        "type": "ByColumn"
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                ],
                                "relationship": [],
                                "return": {
                                    "expression": {
                                        "path": "interval",
                                        "scope": "sortedIntervals",
                                        "type": "Property"
                                    }
                                }
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "intervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}Date",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Sort DateTime Intervals",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "If",
                        "condition": {
                            "type": "IsNull",
                            "operand": {
                                "name": "intervals",
                                "type": "OperandRef"
                            }
                        },
                        "then": {
                            "strict": false,
                            "type": "As",
                            "operand": {
                                "type": "List"
                            },
                            "asTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        },
                        "else": {
                            "type": "If",
                            "condition": {
                                "type": "Equal",
                                "operand": [
                                    {
                                        "type": "Count",
                                        "source": {
                                            "name": "intervals",
                                            "type": "OperandRef"
                                        }
                                    },
                                    {
                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                        "value": "0",
                                        "type": "Literal"
                                    }
                                ]
                            },
                            "then": {
                                "strict": false,
                                "type": "As",
                                "operand": {
                                    "type": "List"
                                },
                                "asTypeSpecifier": {
                                    "type": "ListTypeSpecifier",
                                    "elementType": {
                                        "type": "IntervalTypeSpecifier",
                                        "pointType": {
                                            "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                            "type": "NamedTypeSpecifier"
                                        }
                                    }
                                }
                            },
                            "else": {
                                "type": "Query",
                                "source": [
                                    {
                                        "alias": "sortedIntervals",
                                        "expression": {
                                            "type": "Query",
                                            "source": [
                                                {
                                                    "alias": "I",
                                                    "expression": {
                                                        "name": "intervals",
                                                        "type": "OperandRef"
                                                    }
                                                }
                                            ],
                                            "relationship": [],
                                            "return": {
                                                "expression": {
                                                    "type": "Tuple",
                                                    "element": [
                                                        {
                                                            "name": "interval",
                                                            "value": {
                                                                "name": "I",
                                                                "type": "AliasRef"
                                                            }
                                                        },
                                                        {
                                                            "name": "startOfInterval",
                                                            "value": {
                                                                "type": "If",
                                                                "condition": {
                                                                    "type": "IsNull",
                                                                    "operand": {
                                                                        "type": "Start",
                                                                        "operand": {
                                                                            "name": "I",
                                                                            "type": "AliasRef"
                                                                        }
                                                                    }
                                                                },
                                                                "then": {
                                                                    "valueType": "{urn:hl7-org:elm-types:r1}DateTime",
                                                                    "type": "MinValue"
                                                                },
                                                                "else": {
                                                                    "type": "Start",
                                                                    "operand": {
                                                                        "name": "I",
                                                                        "type": "AliasRef"
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            "sort": {
                                                "by": [
                                                    {
                                                        "direction": "asc",
                                                        "path": "startOfInterval",
                                                        "type": "ByColumn"
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                ],
                                "relationship": [],
                                "return": {
                                    "expression": {
                                        "path": "interval",
                                        "scope": "sortedIntervals",
                                        "type": "Property"
                                    }
                                }
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "intervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Collapse Date Interval Workaround",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "If",
                        "condition": {
                            "type": "IsNull",
                            "operand": {
                                "name": "intervals",
                                "type": "OperandRef"
                            }
                        },
                        "then": {
                            "strict": false,
                            "type": "As",
                            "operand": {
                                "type": "List"
                            },
                            "asTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}Date",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        },
                        "else": {
                            "type": "If",
                            "condition": {
                                "type": "Equal",
                                "operand": [
                                    {
                                        "type": "Count",
                                        "source": {
                                            "name": "intervals",
                                            "type": "OperandRef"
                                        }
                                    },
                                    {
                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                        "value": "0",
                                        "type": "Literal"
                                    }
                                ]
                            },
                            "then": {
                                "strict": false,
                                "type": "As",
                                "operand": {
                                    "type": "List"
                                },
                                "asTypeSpecifier": {
                                    "type": "ListTypeSpecifier",
                                    "elementType": {
                                        "type": "IntervalTypeSpecifier",
                                        "pointType": {
                                            "name": "{urn:hl7-org:elm-types:r1}Date",
                                            "type": "NamedTypeSpecifier"
                                        }
                                    }
                                }
                            },
                            "else": {
                                "type": "Collapse",
                                "operand": [
                                    {
                                        "type": "Query",
                                        "source": [
                                            {
                                                "alias": "I",
                                                "expression": {
                                                    "name": "intervals",
                                                    "type": "OperandRef"
                                                }
                                            }
                                        ],
                                        "relationship": [],
                                        "where": {
                                            "type": "Not",
                                            "operand": {
                                                "type": "AnyTrue",
                                                "source": {
                                                    "type": "Query",
                                                    "source": [
                                                        {
                                                            "alias": "J",
                                                            "expression": {
                                                                "name": "intervals",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    ],
                                                    "relationship": [],
                                                    "return": {
                                                        "expression": {
                                                            "type": "ProperIncludedIn",
                                                            "operand": [
                                                                {
                                                                    "name": "I",
                                                                    "type": "AliasRef"
                                                                },
                                                                {
                                                                    "name": "J",
                                                                    "type": "AliasRef"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    {
                                        "value": 1.0,
                                        "unit": "day",
                                        "type": "Quantity"
                                    }
                                ]
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "intervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}Date",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Collapse DateTime Interval Workaround",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "If",
                        "condition": {
                            "type": "IsNull",
                            "operand": {
                                "name": "intervals",
                                "type": "OperandRef"
                            }
                        },
                        "then": {
                            "strict": false,
                            "type": "As",
                            "operand": {
                                "type": "List"
                            },
                            "asTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        },
                        "else": {
                            "type": "If",
                            "condition": {
                                "type": "Equal",
                                "operand": [
                                    {
                                        "type": "Count",
                                        "source": {
                                            "name": "intervals",
                                            "type": "OperandRef"
                                        }
                                    },
                                    {
                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                        "value": "0",
                                        "type": "Literal"
                                    }
                                ]
                            },
                            "then": {
                                "strict": false,
                                "type": "As",
                                "operand": {
                                    "type": "List"
                                },
                                "asTypeSpecifier": {
                                    "type": "ListTypeSpecifier",
                                    "elementType": {
                                        "type": "IntervalTypeSpecifier",
                                        "pointType": {
                                            "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                            "type": "NamedTypeSpecifier"
                                        }
                                    }
                                }
                            },
                            "else": {
                                "type": "Collapse",
                                "operand": [
                                    {
                                        "type": "Query",
                                        "source": [
                                            {
                                                "alias": "I",
                                                "expression": {
                                                    "name": "intervals",
                                                    "type": "OperandRef"
                                                }
                                            }
                                        ],
                                        "relationship": [],
                                        "where": {
                                            "type": "Not",
                                            "operand": {
                                                "type": "AnyTrue",
                                                "source": {
                                                    "type": "Query",
                                                    "source": [
                                                        {
                                                            "alias": "J",
                                                            "expression": {
                                                                "name": "intervals",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    ],
                                                    "relationship": [],
                                                    "return": {
                                                        "expression": {
                                                            "type": "ProperIncludedIn",
                                                            "operand": [
                                                                {
                                                                    "name": "I",
                                                                    "type": "AliasRef"
                                                                },
                                                                {
                                                                    "name": "J",
                                                                    "type": "AliasRef"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    {
                                        "resultTypeName": "{urn:hl7-org:elm-types:r1}Quantity",
                                        "type": "Null"
                                    }
                                ]
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "intervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Date Interval Covering Relative to Base Interval",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "name": "Collapse Date Interval Workaround",
                        "type": "FunctionRef",
                        "operand": [
                            {
                                "type": "Query",
                                "source": [
                                    {
                                        "alias": "sortedInterval",
                                        "expression": {
                                            "name": "Sort Date Intervals",
                                            "type": "FunctionRef",
                                            "operand": [
                                                {
                                                    "name": "coveringIntervals",
                                                    "type": "OperandRef"
                                                }
                                            ]
                                        }
                                    }
                                ],
                                "relationship": [],
                                "return": {
                                    "expression": {
                                        "type": "Intersect",
                                        "operand": [
                                            {
                                                "name": "baseInterval",
                                                "type": "OperandRef"
                                            },
                                            {
                                                "name": "sortedInterval",
                                                "type": "AliasRef"
                                            }
                                        ]
                                    }
                                }
                            }
                        ]
                    },
                    "operand": [
                        {
                            "name": "baseInterval",
                            "operandTypeSpecifier": {
                                "type": "IntervalTypeSpecifier",
                                "pointType": {
                                    "name": "{urn:hl7-org:elm-types:r1}Date",
                                    "type": "NamedTypeSpecifier"
                                }
                            }
                        },
                        {
                            "name": "coveringIntervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}Date",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "DateTime Interval Covering Relative to Base Interval",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "name": "Collapse DateTime Interval Workaround",
                        "type": "FunctionRef",
                        "operand": [
                            {
                                "type": "Query",
                                "source": [
                                    {
                                        "alias": "sortedInterval",
                                        "expression": {
                                            "name": "Sort DateTime Intervals",
                                            "type": "FunctionRef",
                                            "operand": [
                                                {
                                                    "name": "coveringIntervals",
                                                    "type": "OperandRef"
                                                }
                                            ]
                                        }
                                    }
                                ],
                                "relationship": [],
                                "return": {
                                    "expression": {
                                        "type": "Intersect",
                                        "operand": [
                                            {
                                                "name": "baseInterval",
                                                "type": "OperandRef"
                                            },
                                            {
                                                "name": "sortedInterval",
                                                "type": "AliasRef"
                                            }
                                        ]
                                    }
                                }
                            }
                        ]
                    },
                    "operand": [
                        {
                            "name": "baseInterval",
                            "operandTypeSpecifier": {
                                "type": "IntervalTypeSpecifier",
                                "pointType": {
                                    "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                    "type": "NamedTypeSpecifier"
                                }
                            }
                        },
                        {
                            "name": "coveringIntervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Date Interval Gaps Relative to Base Interval",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "Query",
                        "source": [
                            {
                                "alias": "variableDeclarations",
                                "expression": {
                                    "type": "Tuple",
                                    "element": [
                                        {
                                            "name": "sortedCoverings",
                                            "value": {
                                                "name": "Date Interval Covering Relative to Base Interval",
                                                "type": "FunctionRef",
                                                "operand": [
                                                    {
                                                        "name": "baseInterval",
                                                        "type": "OperandRef"
                                                    },
                                                    {
                                                        "name": "coveringIntervals",
                                                        "type": "OperandRef"
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ],
                        "relationship": [],
                        "return": {
                            "expression": {
                                "type": "Query",
                                "source": [
                                    {
                                        "alias": "calculations",
                                        "expression": {
                                            "type": "Tuple",
                                            "element": [
                                                {
                                                    "name": "frontgaps",
                                                    "value": {
                                                        "type": "If",
                                                        "condition": {
                                                            "type": "Equal",
                                                            "operand": [
                                                                {
                                                                    "type": "Count",
                                                                    "source": {
                                                                        "path": "sortedCoverings",
                                                                        "scope": "variableDeclarations",
                                                                        "type": "Property"
                                                                    }
                                                                },
                                                                {
                                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                    "value": "0",
                                                                    "type": "Literal"
                                                                }
                                                            ]
                                                        },
                                                        "then": {
                                                            "type": "List",
                                                            "element": [
                                                                {
                                                                    "name": "baseInterval",
                                                                    "type": "OperandRef"
                                                                }
                                                            ]
                                                        },
                                                        "else": {
                                                            "type": "Query",
                                                            "source": [
                                                                {
                                                                    "alias": "sortedCovering",
                                                                    "expression": {
                                                                        "path": "sortedCoverings",
                                                                        "scope": "variableDeclarations",
                                                                        "type": "Property"
                                                                    }
                                                                }
                                                            ],
                                                            "relationship": [],
                                                            "return": {
                                                                "expression": {
                                                                    "type": "If",
                                                                    "condition": {
                                                                        "type": "Equal",
                                                                        "operand": [
                                                                            {
                                                                                "type": "IndexOf",
                                                                                "source": {
                                                                                    "path": "sortedCoverings",
                                                                                    "scope": "variableDeclarations",
                                                                                    "type": "Property"
                                                                                },
                                                                                "element": {
                                                                                    "name": "sortedCovering",
                                                                                    "type": "AliasRef"
                                                                                }
                                                                            },
                                                                            {
                                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                "value": "0",
                                                                                "type": "Literal"
                                                                            }
                                                                        ]
                                                                    },
                                                                    "then": {
                                                                        "type": "Except",
                                                                        "operand": [
                                                                            {
                                                                                "type": "Intersect",
                                                                                "operand": [
                                                                                    {
                                                                                        "lowClosed": true,
                                                                                        "highClosed": true,
                                                                                        "type": "Interval",
                                                                                        "low": {
                                                                                            "type": "Start",
                                                                                            "operand": {
                                                                                                "name": "baseInterval",
                                                                                                "type": "OperandRef"
                                                                                            }
                                                                                        },
                                                                                        "high": {
                                                                                            "type": "Start",
                                                                                            "operand": {
                                                                                                "name": "sortedCovering",
                                                                                                "type": "AliasRef"
                                                                                            }
                                                                                        }
                                                                                    },
                                                                                    {
                                                                                        "name": "baseInterval",
                                                                                        "type": "OperandRef"
                                                                                    }
                                                                                ]
                                                                            },
                                                                            {
                                                                                "name": "sortedCovering",
                                                                                "type": "AliasRef"
                                                                            }
                                                                        ]
                                                                    },
                                                                    "else": {
                                                                        "type": "Except",
                                                                        "operand": [
                                                                            {
                                                                                "type": "Except",
                                                                                "operand": [
                                                                                    {
                                                                                        "lowClosed": false,
                                                                                        "highClosed": false,
                                                                                        "type": "Interval",
                                                                                        "low": {
                                                                                            "type": "Start",
                                                                                            "operand": {
                                                                                                "type": "Indexer",
                                                                                                "operand": [
                                                                                                    {
                                                                                                        "path": "sortedCoverings",
                                                                                                        "scope": "variableDeclarations",
                                                                                                        "type": "Property"
                                                                                                    },
                                                                                                    {
                                                                                                        "type": "Subtract",
                                                                                                        "operand": [
                                                                                                            {
                                                                                                                "type": "IndexOf",
                                                                                                                "source": {
                                                                                                                    "path": "sortedCoverings",
                                                                                                                    "scope": "variableDeclarations",
                                                                                                                    "type": "Property"
                                                                                                                },
                                                                                                                "element": {
                                                                                                                    "name": "sortedCovering",
                                                                                                                    "type": "AliasRef"
                                                                                                                }
                                                                                                            },
                                                                                                            {
                                                                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                                "value": "1",
                                                                                                                "type": "Literal"
                                                                                                            }
                                                                                                        ]
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        },
                                                                                        "high": {
                                                                                            "type": "End",
                                                                                            "operand": {
                                                                                                "name": "sortedCovering",
                                                                                                "type": "AliasRef"
                                                                                            }
                                                                                        }
                                                                                    },
                                                                                    {
                                                                                        "type": "Indexer",
                                                                                        "operand": [
                                                                                            {
                                                                                                "path": "sortedCoverings",
                                                                                                "scope": "variableDeclarations",
                                                                                                "type": "Property"
                                                                                            },
                                                                                            {
                                                                                                "type": "Subtract",
                                                                                                "operand": [
                                                                                                    {
                                                                                                        "type": "IndexOf",
                                                                                                        "source": {
                                                                                                            "path": "sortedCoverings",
                                                                                                            "scope": "variableDeclarations",
                                                                                                            "type": "Property"
                                                                                                        },
                                                                                                        "element": {
                                                                                                            "name": "sortedCovering",
                                                                                                            "type": "AliasRef"
                                                                                                        }
                                                                                                    },
                                                                                                    {
                                                                                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                        "value": "1",
                                                                                                        "type": "Literal"
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            },
                                                                            {
                                                                                "name": "sortedCovering",
                                                                                "type": "AliasRef"
                                                                            }
                                                                        ]
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "name": "endgap",
                                                    "value": {
                                                        "type": "If",
                                                        "condition": {
                                                            "type": "Equal",
                                                            "operand": [
                                                                {
                                                                    "type": "Count",
                                                                    "source": {
                                                                        "path": "sortedCoverings",
                                                                        "scope": "variableDeclarations",
                                                                        "type": "Property"
                                                                    }
                                                                },
                                                                {
                                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                    "value": "0",
                                                                    "type": "Literal"
                                                                }
                                                            ]
                                                        },
                                                        "then": {
                                                            "strict": false,
                                                            "type": "As",
                                                            "operand": {
                                                                "type": "List"
                                                            },
                                                            "asTypeSpecifier": {
                                                                "type": "ListTypeSpecifier",
                                                                "elementType": {
                                                                    "type": "IntervalTypeSpecifier",
                                                                    "pointType": {
                                                                        "name": "{urn:hl7-org:elm-types:r1}Date",
                                                                        "type": "NamedTypeSpecifier"
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        "else": {
                                                            "type": "List",
                                                            "element": [
                                                                {
                                                                    "type": "Intersect",
                                                                    "operand": [
                                                                        {
                                                                            "type": "Except",
                                                                            "operand": [
                                                                                {
                                                                                    "lowClosed": false,
                                                                                    "highClosed": true,
                                                                                    "type": "Interval",
                                                                                    "low": {
                                                                                        "type": "Start",
                                                                                        "operand": {
                                                                                            "type": "Last",
                                                                                            "source": {
                                                                                                "path": "sortedCoverings",
                                                                                                "scope": "variableDeclarations",
                                                                                                "type": "Property"
                                                                                            }
                                                                                        }
                                                                                    },
                                                                                    "high": {
                                                                                        "type": "End",
                                                                                        "operand": {
                                                                                            "name": "baseInterval",
                                                                                            "type": "OperandRef"
                                                                                        }
                                                                                    }
                                                                                },
                                                                                {
                                                                                    "type": "Last",
                                                                                    "source": {
                                                                                        "path": "sortedCoverings",
                                                                                        "scope": "variableDeclarations",
                                                                                        "type": "Property"
                                                                                    }
                                                                                }
                                                                            ]
                                                                        },
                                                                        {
                                                                            "name": "baseInterval",
                                                                            "type": "OperandRef"
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ],
                                "relationship": [],
                                "return": {
                                    "expression": {
                                        "name": "Collapse Date Interval Workaround",
                                        "type": "FunctionRef",
                                        "operand": [
                                            {
                                                "type": "Union",
                                                "operand": [
                                                    {
                                                        "path": "frontgaps",
                                                        "scope": "calculations",
                                                        "type": "Property"
                                                    },
                                                    {
                                                        "path": "endgap",
                                                        "scope": "calculations",
                                                        "type": "Property"
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "baseInterval",
                            "operandTypeSpecifier": {
                                "type": "IntervalTypeSpecifier",
                                "pointType": {
                                    "name": "{urn:hl7-org:elm-types:r1}Date",
                                    "type": "NamedTypeSpecifier"
                                }
                            }
                        },
                        {
                            "name": "coveringIntervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}Date",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "DateTime Interval Gaps Relative to Base Interval",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "Query",
                        "source": [
                            {
                                "alias": "variableDeclarations",
                                "expression": {
                                    "type": "Tuple",
                                    "element": [
                                        {
                                            "name": "sortedCoverings",
                                            "value": {
                                                "name": "DateTime Interval Covering Relative to Base Interval",
                                                "type": "FunctionRef",
                                                "operand": [
                                                    {
                                                        "name": "baseInterval",
                                                        "type": "OperandRef"
                                                    },
                                                    {
                                                        "name": "coveringIntervals",
                                                        "type": "OperandRef"
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ],
                        "relationship": [],
                        "return": {
                            "expression": {
                                "type": "Query",
                                "source": [
                                    {
                                        "alias": "calculations",
                                        "expression": {
                                            "type": "Tuple",
                                            "element": [
                                                {
                                                    "name": "frontgaps",
                                                    "value": {
                                                        "type": "If",
                                                        "condition": {
                                                            "type": "Equal",
                                                            "operand": [
                                                                {
                                                                    "type": "Count",
                                                                    "source": {
                                                                        "path": "sortedCoverings",
                                                                        "scope": "variableDeclarations",
                                                                        "type": "Property"
                                                                    }
                                                                },
                                                                {
                                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                    "value": "0",
                                                                    "type": "Literal"
                                                                }
                                                            ]
                                                        },
                                                        "then": {
                                                            "type": "List",
                                                            "element": [
                                                                {
                                                                    "name": "baseInterval",
                                                                    "type": "OperandRef"
                                                                }
                                                            ]
                                                        },
                                                        "else": {
                                                            "type": "Query",
                                                            "source": [
                                                                {
                                                                    "alias": "sortedCovering",
                                                                    "expression": {
                                                                        "path": "sortedCoverings",
                                                                        "scope": "variableDeclarations",
                                                                        "type": "Property"
                                                                    }
                                                                }
                                                            ],
                                                            "relationship": [],
                                                            "return": {
                                                                "expression": {
                                                                    "type": "If",
                                                                    "condition": {
                                                                        "type": "Equal",
                                                                        "operand": [
                                                                            {
                                                                                "type": "IndexOf",
                                                                                "source": {
                                                                                    "path": "sortedCoverings",
                                                                                    "scope": "variableDeclarations",
                                                                                    "type": "Property"
                                                                                },
                                                                                "element": {
                                                                                    "name": "sortedCovering",
                                                                                    "type": "AliasRef"
                                                                                }
                                                                            },
                                                                            {
                                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                "value": "0",
                                                                                "type": "Literal"
                                                                            }
                                                                        ]
                                                                    },
                                                                    "then": {
                                                                        "type": "Except",
                                                                        "operand": [
                                                                            {
                                                                                "type": "Intersect",
                                                                                "operand": [
                                                                                    {
                                                                                        "lowClosed": true,
                                                                                        "highClosed": true,
                                                                                        "type": "Interval",
                                                                                        "low": {
                                                                                            "type": "Start",
                                                                                            "operand": {
                                                                                                "name": "baseInterval",
                                                                                                "type": "OperandRef"
                                                                                            }
                                                                                        },
                                                                                        "high": {
                                                                                            "type": "Start",
                                                                                            "operand": {
                                                                                                "name": "sortedCovering",
                                                                                                "type": "AliasRef"
                                                                                            }
                                                                                        }
                                                                                    },
                                                                                    {
                                                                                        "name": "baseInterval",
                                                                                        "type": "OperandRef"
                                                                                    }
                                                                                ]
                                                                            },
                                                                            {
                                                                                "name": "sortedCovering",
                                                                                "type": "AliasRef"
                                                                            }
                                                                        ]
                                                                    },
                                                                    "else": {
                                                                        "type": "Except",
                                                                        "operand": [
                                                                            {
                                                                                "type": "Except",
                                                                                "operand": [
                                                                                    {
                                                                                        "lowClosed": false,
                                                                                        "highClosed": false,
                                                                                        "type": "Interval",
                                                                                        "low": {
                                                                                            "type": "Start",
                                                                                            "operand": {
                                                                                                "type": "Indexer",
                                                                                                "operand": [
                                                                                                    {
                                                                                                        "path": "sortedCoverings",
                                                                                                        "scope": "variableDeclarations",
                                                                                                        "type": "Property"
                                                                                                    },
                                                                                                    {
                                                                                                        "type": "Subtract",
                                                                                                        "operand": [
                                                                                                            {
                                                                                                                "type": "IndexOf",
                                                                                                                "source": {
                                                                                                                    "path": "sortedCoverings",
                                                                                                                    "scope": "variableDeclarations",
                                                                                                                    "type": "Property"
                                                                                                                },
                                                                                                                "element": {
                                                                                                                    "name": "sortedCovering",
                                                                                                                    "type": "AliasRef"
                                                                                                                }
                                                                                                            },
                                                                                                            {
                                                                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                                "value": "1",
                                                                                                                "type": "Literal"
                                                                                                            }
                                                                                                        ]
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        },
                                                                                        "high": {
                                                                                            "type": "End",
                                                                                            "operand": {
                                                                                                "name": "sortedCovering",
                                                                                                "type": "AliasRef"
                                                                                            }
                                                                                        }
                                                                                    },
                                                                                    {
                                                                                        "type": "Indexer",
                                                                                        "operand": [
                                                                                            {
                                                                                                "path": "sortedCoverings",
                                                                                                "scope": "variableDeclarations",
                                                                                                "type": "Property"
                                                                                            },
                                                                                            {
                                                                                                "type": "Subtract",
                                                                                                "operand": [
                                                                                                    {
                                                                                                        "type": "IndexOf",
                                                                                                        "source": {
                                                                                                            "path": "sortedCoverings",
                                                                                                            "scope": "variableDeclarations",
                                                                                                            "type": "Property"
                                                                                                        },
                                                                                                        "element": {
                                                                                                            "name": "sortedCovering",
                                                                                                            "type": "AliasRef"
                                                                                                        }
                                                                                                    },
                                                                                                    {
                                                                                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                        "value": "1",
                                                                                                        "type": "Literal"
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            },
                                                                            {
                                                                                "name": "sortedCovering",
                                                                                "type": "AliasRef"
                                                                            }
                                                                        ]
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "name": "endgap",
                                                    "value": {
                                                        "type": "If",
                                                        "condition": {
                                                            "type": "Equal",
                                                            "operand": [
                                                                {
                                                                    "type": "Count",
                                                                    "source": {
                                                                        "path": "sortedCoverings",
                                                                        "scope": "variableDeclarations",
                                                                        "type": "Property"
                                                                    }
                                                                },
                                                                {
                                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                    "value": "0",
                                                                    "type": "Literal"
                                                                }
                                                            ]
                                                        },
                                                        "then": {
                                                            "strict": false,
                                                            "type": "As",
                                                            "operand": {
                                                                "type": "List"
                                                            },
                                                            "asTypeSpecifier": {
                                                                "type": "ListTypeSpecifier",
                                                                "elementType": {
                                                                    "type": "IntervalTypeSpecifier",
                                                                    "pointType": {
                                                                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                                                        "type": "NamedTypeSpecifier"
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        "else": {
                                                            "type": "List",
                                                            "element": [
                                                                {
                                                                    "type": "Intersect",
                                                                    "operand": [
                                                                        {
                                                                            "type": "Except",
                                                                            "operand": [
                                                                                {
                                                                                    "lowClosed": false,
                                                                                    "highClosed": true,
                                                                                    "type": "Interval",
                                                                                    "low": {
                                                                                        "type": "Start",
                                                                                        "operand": {
                                                                                            "type": "Last",
                                                                                            "source": {
                                                                                                "path": "sortedCoverings",
                                                                                                "scope": "variableDeclarations",
                                                                                                "type": "Property"
                                                                                            }
                                                                                        }
                                                                                    },
                                                                                    "high": {
                                                                                        "type": "End",
                                                                                        "operand": {
                                                                                            "name": "baseInterval",
                                                                                            "type": "OperandRef"
                                                                                        }
                                                                                    }
                                                                                },
                                                                                {
                                                                                    "type": "Last",
                                                                                    "source": {
                                                                                        "path": "sortedCoverings",
                                                                                        "scope": "variableDeclarations",
                                                                                        "type": "Property"
                                                                                    }
                                                                                }
                                                                            ]
                                                                        },
                                                                        {
                                                                            "name": "baseInterval",
                                                                            "type": "OperandRef"
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ],
                                "relationship": [],
                                "return": {
                                    "expression": {
                                        "name": "Collapse DateTime Interval Workaround",
                                        "type": "FunctionRef",
                                        "operand": [
                                            {
                                                "type": "Union",
                                                "operand": [
                                                    {
                                                        "path": "frontgaps",
                                                        "scope": "calculations",
                                                        "type": "Property"
                                                    },
                                                    {
                                                        "path": "endgap",
                                                        "scope": "calculations",
                                                        "type": "Property"
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "baseInterval",
                            "operandTypeSpecifier": {
                                "type": "IntervalTypeSpecifier",
                                "pointType": {
                                    "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                    "type": "NamedTypeSpecifier"
                                }
                            }
                        },
                        {
                            "name": "coveringIntervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Collapsed Date Interval Stats",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "Tuple",
                        "element": [
                            {
                                "name": "Intervals",
                                "value": {
                                    "name": "collapsedIntervals",
                                    "type": "OperandRef"
                                }
                            },
                            {
                                "name": "Interval Count",
                                "value": {
                                    "type": "Count",
                                    "source": {
                                        "name": "collapsedIntervals",
                                        "type": "OperandRef"
                                    }
                                }
                            },
                            {
                                "name": "Total Days In Intervals",
                                "value": {
                                    "type": "If",
                                    "condition": {
                                        "type": "Equal",
                                        "operand": [
                                            {
                                                "type": "Count",
                                                "source": {
                                                    "name": "collapsedIntervals",
                                                    "type": "OperandRef"
                                                }
                                            },
                                            {
                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                "value": "0",
                                                "type": "Literal"
                                            }
                                        ]
                                    },
                                    "then": {
                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                        "value": "0",
                                        "type": "Literal"
                                    },
                                    "else": {
                                        "type": "Sum",
                                        "source": {
                                            "type": "Query",
                                            "source": [
                                                {
                                                    "alias": "I",
                                                    "expression": {
                                                        "name": "collapsedIntervals",
                                                        "type": "OperandRef"
                                                    }
                                                }
                                            ],
                                            "relationship": [],
                                            "return": {
                                                "expression": {
                                                    "type": "Max",
                                                    "source": {
                                                        "type": "List",
                                                        "element": [
                                                            {
                                                                "type": "Add",
                                                                "operand": [
                                                                    {
                                                                        "precision": "Day",
                                                                        "type": "DurationBetween",
                                                                        "operand": [
                                                                            {
                                                                                "type": "Start",
                                                                                "operand": {
                                                                                    "name": "I",
                                                                                    "type": "AliasRef"
                                                                                }
                                                                            },
                                                                            {
                                                                                "type": "End",
                                                                                "operand": {
                                                                                    "name": "I",
                                                                                    "type": "AliasRef"
                                                                                }
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                        "value": "1",
                                                                        "type": "Literal"
                                                                    }
                                                                ]
                                                            },
                                                            {
                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                "value": "0",
                                                                "type": "Literal"
                                                            }
                                                        ]
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            {
                                "name": "Longest Interval",
                                "value": {
                                    "type": "If",
                                    "condition": {
                                        "type": "Equal",
                                        "operand": [
                                            {
                                                "type": "Count",
                                                "source": {
                                                    "name": "collapsedIntervals",
                                                    "type": "OperandRef"
                                                }
                                            },
                                            {
                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                "value": "0",
                                                "type": "Literal"
                                            }
                                        ]
                                    },
                                    "then": {
                                        "strict": false,
                                        "type": "As",
                                        "operand": {
                                            "type": "Null"
                                        },
                                        "asTypeSpecifier": {
                                            "type": "IntervalTypeSpecifier",
                                            "pointType": {
                                                "name": "{urn:hl7-org:elm-types:r1}Date",
                                                "type": "NamedTypeSpecifier"
                                            }
                                        }
                                    },
                                    "else": {
                                        "path": "interval",
                                        "type": "Property",
                                        "source": {
                                            "type": "First",
                                            "source": {
                                                "type": "Query",
                                                "source": [
                                                    {
                                                        "alias": "I",
                                                        "expression": {
                                                            "name": "collapsedIntervals",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                ],
                                                "relationship": [],
                                                "return": {
                                                    "expression": {
                                                        "type": "Tuple",
                                                        "element": [
                                                            {
                                                                "name": "interval",
                                                                "value": {
                                                                    "name": "I",
                                                                    "type": "AliasRef"
                                                                }
                                                            },
                                                            {
                                                                "name": "days",
                                                                "value": {
                                                                    "type": "Max",
                                                                    "source": {
                                                                        "type": "List",
                                                                        "element": [
                                                                            {
                                                                                "type": "Add",
                                                                                "operand": [
                                                                                    {
                                                                                        "precision": "Day",
                                                                                        "type": "DurationBetween",
                                                                                        "operand": [
                                                                                            {
                                                                                                "type": "Start",
                                                                                                "operand": {
                                                                                                    "name": "I",
                                                                                                    "type": "AliasRef"
                                                                                                }
                                                                                            },
                                                                                            {
                                                                                                "type": "End",
                                                                                                "operand": {
                                                                                                    "name": "I",
                                                                                                    "type": "AliasRef"
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    },
                                                                                    {
                                                                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                        "value": "1",
                                                                                        "type": "Literal"
                                                                                    }
                                                                                ]
                                                                            },
                                                                            {
                                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                "value": "0",
                                                                                "type": "Literal"
                                                                            }
                                                                        ]
                                                                    }
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },
                                                "sort": {
                                                    "by": [
                                                        {
                                                            "direction": "desc",
                                                            "path": "days",
                                                            "type": "ByColumn"
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            {
                                "name": "Total Days In Longest Interval",
                                "value": {
                                    "type": "If",
                                    "condition": {
                                        "type": "Equal",
                                        "operand": [
                                            {
                                                "type": "Count",
                                                "source": {
                                                    "name": "collapsedIntervals",
                                                    "type": "OperandRef"
                                                }
                                            },
                                            {
                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                "value": "0",
                                                "type": "Literal"
                                            }
                                        ]
                                    },
                                    "then": {
                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                        "value": "0",
                                        "type": "Literal"
                                    },
                                    "else": {
                                        "type": "Max",
                                        "source": {
                                            "type": "List",
                                            "element": [
                                                {
                                                    "type": "Add",
                                                    "operand": [
                                                        {
                                                            "precision": "Day",
                                                            "type": "DurationBetween",
                                                            "operand": [
                                                                {
                                                                    "type": "Start",
                                                                    "operand": {
                                                                        "path": "interval",
                                                                        "type": "Property",
                                                                        "source": {
                                                                            "type": "First",
                                                                            "source": {
                                                                                "type": "Query",
                                                                                "source": [
                                                                                    {
                                                                                        "alias": "I",
                                                                                        "expression": {
                                                                                            "name": "collapsedIntervals",
                                                                                            "type": "OperandRef"
                                                                                        }
                                                                                    }
                                                                                ],
                                                                                "relationship": [],
                                                                                "return": {
                                                                                    "expression": {
                                                                                        "type": "Tuple",
                                                                                        "element": [
                                                                                            {
                                                                                                "name": "interval",
                                                                                                "value": {
                                                                                                    "name": "I",
                                                                                                    "type": "AliasRef"
                                                                                                }
                                                                                            },
                                                                                            {
                                                                                                "name": "days",
                                                                                                "value": {
                                                                                                    "type": "Max",
                                                                                                    "source": {
                                                                                                        "type": "List",
                                                                                                        "element": [
                                                                                                            {
                                                                                                                "type": "Add",
                                                                                                                "operand": [
                                                                                                                    {
                                                                                                                        "precision": "Day",
                                                                                                                        "type": "DurationBetween",
                                                                                                                        "operand": [
                                                                                                                            {
                                                                                                                                "type": "Start",
                                                                                                                                "operand": {
                                                                                                                                    "name": "I",
                                                                                                                                    "type": "AliasRef"
                                                                                                                                }
                                                                                                                            },
                                                                                                                            {
                                                                                                                                "type": "End",
                                                                                                                                "operand": {
                                                                                                                                    "name": "I",
                                                                                                                                    "type": "AliasRef"
                                                                                                                                }
                                                                                                                            }
                                                                                                                        ]
                                                                                                                    },
                                                                                                                    {
                                                                                                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                                        "value": "1",
                                                                                                                        "type": "Literal"
                                                                                                                    }
                                                                                                                ]
                                                                                                            },
                                                                                                            {
                                                                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                                "value": "0",
                                                                                                                "type": "Literal"
                                                                                                            }
                                                                                                        ]
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                },
                                                                                "sort": {
                                                                                    "by": [
                                                                                        {
                                                                                            "direction": "desc",
                                                                                            "path": "days",
                                                                                            "type": "ByColumn"
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                },
                                                                {
                                                                    "type": "End",
                                                                    "operand": {
                                                                        "path": "interval",
                                                                        "type": "Property",
                                                                        "source": {
                                                                            "type": "First",
                                                                            "source": {
                                                                                "type": "Query",
                                                                                "source": [
                                                                                    {
                                                                                        "alias": "I",
                                                                                        "expression": {
                                                                                            "name": "collapsedIntervals",
                                                                                            "type": "OperandRef"
                                                                                        }
                                                                                    }
                                                                                ],
                                                                                "relationship": [],
                                                                                "return": {
                                                                                    "expression": {
                                                                                        "type": "Tuple",
                                                                                        "element": [
                                                                                            {
                                                                                                "name": "interval",
                                                                                                "value": {
                                                                                                    "name": "I",
                                                                                                    "type": "AliasRef"
                                                                                                }
                                                                                            },
                                                                                            {
                                                                                                "name": "days",
                                                                                                "value": {
                                                                                                    "type": "Max",
                                                                                                    "source": {
                                                                                                        "type": "List",
                                                                                                        "element": [
                                                                                                            {
                                                                                                                "type": "Add",
                                                                                                                "operand": [
                                                                                                                    {
                                                                                                                        "precision": "Day",
                                                                                                                        "type": "DurationBetween",
                                                                                                                        "operand": [
                                                                                                                            {
                                                                                                                                "type": "Start",
                                                                                                                                "operand": {
                                                                                                                                    "name": "I",
                                                                                                                                    "type": "AliasRef"
                                                                                                                                }
                                                                                                                            },
                                                                                                                            {
                                                                                                                                "type": "End",
                                                                                                                                "operand": {
                                                                                                                                    "name": "I",
                                                                                                                                    "type": "AliasRef"
                                                                                                                                }
                                                                                                                            }
                                                                                                                        ]
                                                                                                                    },
                                                                                                                    {
                                                                                                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                                        "value": "1",
                                                                                                                        "type": "Literal"
                                                                                                                    }
                                                                                                                ]
                                                                                                            },
                                                                                                            {
                                                                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                                "value": "0",
                                                                                                                "type": "Literal"
                                                                                                            }
                                                                                                        ]
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                },
                                                                                "sort": {
                                                                                    "by": [
                                                                                        {
                                                                                            "direction": "desc",
                                                                                            "path": "days",
                                                                                            "type": "ByColumn"
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                            "value": "1",
                                                            "type": "Literal"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                }
                                            ]
                                        }
                                    }
                                }
                            }
                        ]
                    },
                    "operand": [
                        {
                            "name": "collapsedIntervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}Date",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Date Interval Covering Relative to Base Interval Stats",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "Query",
                        "source": [
                            {
                                "alias": "variableDeclarations",
                                "expression": {
                                    "type": "Tuple",
                                    "element": [
                                        {
                                            "name": "Covering Intervals",
                                            "value": {
                                                "name": "Date Interval Covering Relative to Base Interval",
                                                "type": "FunctionRef",
                                                "operand": [
                                                    {
                                                        "name": "baseInterval",
                                                        "type": "OperandRef"
                                                    },
                                                    {
                                                        "name": "coveringIntervals",
                                                        "type": "OperandRef"
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ],
                        "relationship": [],
                        "return": {
                            "expression": {
                                "name": "Collapsed Date Interval Stats",
                                "type": "FunctionRef",
                                "operand": [
                                    {
                                        "path": "Covering Intervals",
                                        "scope": "variableDeclarations",
                                        "type": "Property"
                                    }
                                ]
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "baseInterval",
                            "operandTypeSpecifier": {
                                "type": "IntervalTypeSpecifier",
                                "pointType": {
                                    "name": "{urn:hl7-org:elm-types:r1}Date",
                                    "type": "NamedTypeSpecifier"
                                }
                            }
                        },
                        {
                            "name": "coveringIntervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}Date",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Date Interval Gaps Relative to Base Interval Stats",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "Query",
                        "source": [
                            {
                                "alias": "variableDeclarations",
                                "expression": {
                                    "type": "Tuple",
                                    "element": [
                                        {
                                            "name": "Gap Intervals",
                                            "value": {
                                                "name": "Date Interval Gaps Relative to Base Interval",
                                                "type": "FunctionRef",
                                                "operand": [
                                                    {
                                                        "name": "baseInterval",
                                                        "type": "OperandRef"
                                                    },
                                                    {
                                                        "name": "coveringIntervals",
                                                        "type": "OperandRef"
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ],
                        "relationship": [],
                        "return": {
                            "expression": {
                                "name": "Collapsed Date Interval Stats",
                                "type": "FunctionRef",
                                "operand": [
                                    {
                                        "path": "Gap Intervals",
                                        "scope": "variableDeclarations",
                                        "type": "Property"
                                    }
                                ]
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "baseInterval",
                            "operandTypeSpecifier": {
                                "type": "IntervalTypeSpecifier",
                                "pointType": {
                                    "name": "{urn:hl7-org:elm-types:r1}Date",
                                    "type": "NamedTypeSpecifier"
                                }
                            }
                        },
                        {
                            "name": "coveringIntervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}Date",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "DateTime Interval Set Nulls to Zero",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "Query",
                        "source": [
                            {
                                "alias": "i",
                                "expression": {
                                    "type": "Tuple",
                                    "element": [
                                        {
                                            "name": "StartYear",
                                            "value": {
                                                "precision": "Year",
                                                "type": "DateTimeComponentFrom",
                                                "operand": {
                                                    "type": "Start",
                                                    "operand": {
                                                        "name": "interval",
                                                        "type": "OperandRef"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "StartMonth",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Month",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "Start",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Month",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "Start",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "StartDay",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Day",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "Start",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Day",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "Start",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "StartHour",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Hour",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "Start",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Hour",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "Start",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "StartMinute",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Minute",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "Start",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Minute",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "Start",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "StartSecond",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Second",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "Start",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Second",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "Start",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "StartMillisecond",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Millisecond",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "Start",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Millisecond",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "Start",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "EndYear",
                                            "value": {
                                                "precision": "Year",
                                                "type": "DateTimeComponentFrom",
                                                "operand": {
                                                    "type": "End",
                                                    "operand": {
                                                        "name": "interval",
                                                        "type": "OperandRef"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "EndMonth",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Month",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "End",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Month",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "End",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "EndDay",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Day",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "End",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Day",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "End",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "EndHour",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Hour",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "End",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Hour",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "End",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "EndMinute",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Minute",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "End",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Minute",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "End",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "EndSecond",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Second",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "End",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Second",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "End",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "EndMillisecond",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Millisecond",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "type": "End",
                                                            "operand": {
                                                                "name": "interval",
                                                                "type": "OperandRef"
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Millisecond",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "type": "End",
                                                        "operand": {
                                                            "name": "interval",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        ],
                        "relationship": [],
                        "return": {
                            "expression": {
                                "lowClosed": true,
                                "highClosed": true,
                                "type": "Interval",
                                "low": {
                                    "type": "DateTime",
                                    "year": {
                                        "path": "StartYear",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "month": {
                                        "path": "StartMonth",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "day": {
                                        "path": "StartDay",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "hour": {
                                        "path": "StartHour",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "minute": {
                                        "path": "StartMinute",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "second": {
                                        "path": "StartSecond",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "millisecond": {
                                        "path": "StartMillisecond",
                                        "scope": "i",
                                        "type": "Property"
                                    }
                                },
                                "high": {
                                    "type": "DateTime",
                                    "year": {
                                        "path": "EndYear",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "month": {
                                        "path": "EndMonth",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "day": {
                                        "path": "EndDay",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "hour": {
                                        "path": "EndHour",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "minute": {
                                        "path": "EndMinute",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "second": {
                                        "path": "EndSecond",
                                        "scope": "i",
                                        "type": "Property"
                                    },
                                    "millisecond": {
                                        "path": "EndMillisecond",
                                        "scope": "i",
                                        "type": "Property"
                                    }
                                }
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "interval",
                            "operandTypeSpecifier": {
                                "type": "IntervalTypeSpecifier",
                                "pointType": {
                                    "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                    "type": "NamedTypeSpecifier"
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Collapsed DateTime Interval Stats",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "Tuple",
                        "element": [
                            {
                                "name": "Intervals",
                                "value": {
                                    "name": "collapsedIntervals",
                                    "type": "OperandRef"
                                }
                            },
                            {
                                "name": "Interval Count",
                                "value": {
                                    "type": "Count",
                                    "source": {
                                        "name": "collapsedIntervals",
                                        "type": "OperandRef"
                                    }
                                }
                            },
                            {
                                "name": "Total Days In Intervals",
                                "value": {
                                    "type": "If",
                                    "condition": {
                                        "type": "Equal",
                                        "operand": [
                                            {
                                                "type": "Count",
                                                "source": {
                                                    "name": "collapsedIntervals",
                                                    "type": "OperandRef"
                                                }
                                            },
                                            {
                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                "value": "0",
                                                "type": "Literal"
                                            }
                                        ]
                                    },
                                    "then": {
                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                        "value": "0",
                                        "type": "Literal"
                                    },
                                    "else": {
                                        "type": "Sum",
                                        "source": {
                                            "type": "Query",
                                            "source": [
                                                {
                                                    "alias": "I",
                                                    "expression": {
                                                        "name": "collapsedIntervals",
                                                        "type": "OperandRef"
                                                    }
                                                }
                                            ],
                                            "relationship": [],
                                            "return": {
                                                "expression": {
                                                    "type": "Max",
                                                    "source": {
                                                        "type": "List",
                                                        "element": [
                                                            {
                                                                "type": "Add",
                                                                "operand": [
                                                                    {
                                                                        "precision": "Day",
                                                                        "type": "DurationBetween",
                                                                        "operand": [
                                                                            {
                                                                                "type": "Start",
                                                                                "operand": {
                                                                                    "name": "DateTime Interval Set Nulls to Zero",
                                                                                    "type": "FunctionRef",
                                                                                    "operand": [
                                                                                        {
                                                                                            "name": "I",
                                                                                            "type": "AliasRef"
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            },
                                                                            {
                                                                                "type": "End",
                                                                                "operand": {
                                                                                    "name": "DateTime Interval Set Nulls to Zero",
                                                                                    "type": "FunctionRef",
                                                                                    "operand": [
                                                                                        {
                                                                                            "name": "I",
                                                                                            "type": "AliasRef"
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                        "value": "1",
                                                                        "type": "Literal"
                                                                    }
                                                                ]
                                                            },
                                                            {
                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                "value": "0",
                                                                "type": "Literal"
                                                            }
                                                        ]
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            {
                                "name": "Longest Interval",
                                "value": {
                                    "type": "If",
                                    "condition": {
                                        "type": "Equal",
                                        "operand": [
                                            {
                                                "type": "Count",
                                                "source": {
                                                    "name": "collapsedIntervals",
                                                    "type": "OperandRef"
                                                }
                                            },
                                            {
                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                "value": "0",
                                                "type": "Literal"
                                            }
                                        ]
                                    },
                                    "then": {
                                        "strict": false,
                                        "type": "As",
                                        "operand": {
                                            "type": "Null"
                                        },
                                        "asTypeSpecifier": {
                                            "type": "IntervalTypeSpecifier",
                                            "pointType": {
                                                "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                                "type": "NamedTypeSpecifier"
                                            }
                                        }
                                    },
                                    "else": {
                                        "path": "interval",
                                        "type": "Property",
                                        "source": {
                                            "type": "First",
                                            "source": {
                                                "type": "Query",
                                                "source": [
                                                    {
                                                        "alias": "I",
                                                        "expression": {
                                                            "name": "collapsedIntervals",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                ],
                                                "relationship": [],
                                                "return": {
                                                    "expression": {
                                                        "type": "Tuple",
                                                        "element": [
                                                            {
                                                                "name": "interval",
                                                                "value": {
                                                                    "name": "I",
                                                                    "type": "AliasRef"
                                                                }
                                                            },
                                                            {
                                                                "name": "days",
                                                                "value": {
                                                                    "type": "Max",
                                                                    "source": {
                                                                        "type": "List",
                                                                        "element": [
                                                                            {
                                                                                "type": "Add",
                                                                                "operand": [
                                                                                    {
                                                                                        "precision": "Day",
                                                                                        "type": "DurationBetween",
                                                                                        "operand": [
                                                                                            {
                                                                                                "type": "Start",
                                                                                                "operand": {
                                                                                                    "name": "DateTime Interval Set Nulls to Zero",
                                                                                                    "type": "FunctionRef",
                                                                                                    "operand": [
                                                                                                        {
                                                                                                            "name": "I",
                                                                                                            "type": "AliasRef"
                                                                                                        }
                                                                                                    ]
                                                                                                }
                                                                                            },
                                                                                            {
                                                                                                "type": "End",
                                                                                                "operand": {
                                                                                                    "name": "DateTime Interval Set Nulls to Zero",
                                                                                                    "type": "FunctionRef",
                                                                                                    "operand": [
                                                                                                        {
                                                                                                            "name": "I",
                                                                                                            "type": "AliasRef"
                                                                                                        }
                                                                                                    ]
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    },
                                                                                    {
                                                                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                        "value": "1",
                                                                                        "type": "Literal"
                                                                                    }
                                                                                ]
                                                                            },
                                                                            {
                                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                "value": "0",
                                                                                "type": "Literal"
                                                                            }
                                                                        ]
                                                                    }
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },
                                                "sort": {
                                                    "by": [
                                                        {
                                                            "direction": "desc",
                                                            "path": "days",
                                                            "type": "ByColumn"
                                                        }
                                                    ]
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            {
                                "name": "Total Days In Longest Interval",
                                "value": {
                                    "type": "If",
                                    "condition": {
                                        "type": "Equal",
                                        "operand": [
                                            {
                                                "type": "Count",
                                                "source": {
                                                    "name": "collapsedIntervals",
                                                    "type": "OperandRef"
                                                }
                                            },
                                            {
                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                "value": "0",
                                                "type": "Literal"
                                            }
                                        ]
                                    },
                                    "then": {
                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                        "value": "0",
                                        "type": "Literal"
                                    },
                                    "else": {
                                        "type": "Max",
                                        "source": {
                                            "type": "List",
                                            "element": [
                                                {
                                                    "type": "Add",
                                                    "operand": [
                                                        {
                                                            "precision": "Day",
                                                            "type": "DurationBetween",
                                                            "operand": [
                                                                {
                                                                    "type": "Start",
                                                                    "operand": {
                                                                        "name": "DateTime Interval Set Nulls to Zero",
                                                                        "type": "FunctionRef",
                                                                        "operand": [
                                                                            {
                                                                                "path": "interval",
                                                                                "type": "Property",
                                                                                "source": {
                                                                                    "type": "First",
                                                                                    "source": {
                                                                                        "type": "Query",
                                                                                        "source": [
                                                                                            {
                                                                                                "alias": "I",
                                                                                                "expression": {
                                                                                                    "name": "collapsedIntervals",
                                                                                                    "type": "OperandRef"
                                                                                                }
                                                                                            }
                                                                                        ],
                                                                                        "relationship": [],
                                                                                        "return": {
                                                                                            "expression": {
                                                                                                "type": "Tuple",
                                                                                                "element": [
                                                                                                    {
                                                                                                        "name": "interval",
                                                                                                        "value": {
                                                                                                            "name": "I",
                                                                                                            "type": "AliasRef"
                                                                                                        }
                                                                                                    },
                                                                                                    {
                                                                                                        "name": "days",
                                                                                                        "value": {
                                                                                                            "type": "Max",
                                                                                                            "source": {
                                                                                                                "type": "List",
                                                                                                                "element": [
                                                                                                                    {
                                                                                                                        "type": "Add",
                                                                                                                        "operand": [
                                                                                                                            {
                                                                                                                                "precision": "Day",
                                                                                                                                "type": "DurationBetween",
                                                                                                                                "operand": [
                                                                                                                                    {
                                                                                                                                        "type": "Start",
                                                                                                                                        "operand": {
                                                                                                                                            "name": "DateTime Interval Set Nulls to Zero",
                                                                                                                                            "type": "FunctionRef",
                                                                                                                                            "operand": [
                                                                                                                                                {
                                                                                                                                                    "name": "I",
                                                                                                                                                    "type": "AliasRef"
                                                                                                                                                }
                                                                                                                                            ]
                                                                                                                                        }
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        "type": "End",
                                                                                                                                        "operand": {
                                                                                                                                            "name": "DateTime Interval Set Nulls to Zero",
                                                                                                                                            "type": "FunctionRef",
                                                                                                                                            "operand": [
                                                                                                                                                {
                                                                                                                                                    "name": "I",
                                                                                                                                                    "type": "AliasRef"
                                                                                                                                                }
                                                                                                                                            ]
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                ]
                                                                                                                            },
                                                                                                                            {
                                                                                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                                                "value": "1",
                                                                                                                                "type": "Literal"
                                                                                                                            }
                                                                                                                        ]
                                                                                                                    },
                                                                                                                    {
                                                                                                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                                        "value": "0",
                                                                                                                        "type": "Literal"
                                                                                                                    }
                                                                                                                ]
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        },
                                                                                        "sort": {
                                                                                            "by": [
                                                                                                {
                                                                                                    "direction": "desc",
                                                                                                    "path": "days",
                                                                                                    "type": "ByColumn"
                                                                                                }
                                                                                            ]
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                },
                                                                {
                                                                    "type": "End",
                                                                    "operand": {
                                                                        "name": "DateTime Interval Set Nulls to Zero",
                                                                        "type": "FunctionRef",
                                                                        "operand": [
                                                                            {
                                                                                "path": "interval",
                                                                                "type": "Property",
                                                                                "source": {
                                                                                    "type": "First",
                                                                                    "source": {
                                                                                        "type": "Query",
                                                                                        "source": [
                                                                                            {
                                                                                                "alias": "I",
                                                                                                "expression": {
                                                                                                    "name": "collapsedIntervals",
                                                                                                    "type": "OperandRef"
                                                                                                }
                                                                                            }
                                                                                        ],
                                                                                        "relationship": [],
                                                                                        "return": {
                                                                                            "expression": {
                                                                                                "type": "Tuple",
                                                                                                "element": [
                                                                                                    {
                                                                                                        "name": "interval",
                                                                                                        "value": {
                                                                                                            "name": "I",
                                                                                                            "type": "AliasRef"
                                                                                                        }
                                                                                                    },
                                                                                                    {
                                                                                                        "name": "days",
                                                                                                        "value": {
                                                                                                            "type": "Max",
                                                                                                            "source": {
                                                                                                                "type": "List",
                                                                                                                "element": [
                                                                                                                    {
                                                                                                                        "type": "Add",
                                                                                                                        "operand": [
                                                                                                                            {
                                                                                                                                "precision": "Day",
                                                                                                                                "type": "DurationBetween",
                                                                                                                                "operand": [
                                                                                                                                    {
                                                                                                                                        "type": "Start",
                                                                                                                                        "operand": {
                                                                                                                                            "name": "DateTime Interval Set Nulls to Zero",
                                                                                                                                            "type": "FunctionRef",
                                                                                                                                            "operand": [
                                                                                                                                                {
                                                                                                                                                    "name": "I",
                                                                                                                                                    "type": "AliasRef"
                                                                                                                                                }
                                                                                                                                            ]
                                                                                                                                        }
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        "type": "End",
                                                                                                                                        "operand": {
                                                                                                                                            "name": "DateTime Interval Set Nulls to Zero",
                                                                                                                                            "type": "FunctionRef",
                                                                                                                                            "operand": [
                                                                                                                                                {
                                                                                                                                                    "name": "I",
                                                                                                                                                    "type": "AliasRef"
                                                                                                                                                }
                                                                                                                                            ]
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                ]
                                                                                                                            },
                                                                                                                            {
                                                                                                                                "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                                                "value": "1",
                                                                                                                                "type": "Literal"
                                                                                                                            }
                                                                                                                        ]
                                                                                                                    },
                                                                                                                    {
                                                                                                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                                                                                        "value": "0",
                                                                                                                        "type": "Literal"
                                                                                                                    }
                                                                                                                ]
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        },
                                                                                        "sort": {
                                                                                            "by": [
                                                                                                {
                                                                                                    "direction": "desc",
                                                                                                    "path": "days",
                                                                                                    "type": "ByColumn"
                                                                                                }
                                                                                            ]
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                            "value": "1",
                                                            "type": "Literal"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                }
                                            ]
                                        }
                                    }
                                }
                            }
                        ]
                    },
                    "operand": [
                        {
                            "name": "collapsedIntervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "DateTime Interval Covering Relative to Base Interval Stats",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "Query",
                        "source": [
                            {
                                "alias": "variableDeclarations",
                                "expression": {
                                    "type": "Tuple",
                                    "element": [
                                        {
                                            "name": "Covering Intervals",
                                            "value": {
                                                "name": "DateTime Interval Covering Relative to Base Interval",
                                                "type": "FunctionRef",
                                                "operand": [
                                                    {
                                                        "name": "baseInterval",
                                                        "type": "OperandRef"
                                                    },
                                                    {
                                                        "name": "coveringIntervals",
                                                        "type": "OperandRef"
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ],
                        "relationship": [],
                        "return": {
                            "expression": {
                                "name": "Collapsed DateTime Interval Stats",
                                "type": "FunctionRef",
                                "operand": [
                                    {
                                        "path": "Covering Intervals",
                                        "scope": "variableDeclarations",
                                        "type": "Property"
                                    }
                                ]
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "baseInterval",
                            "operandTypeSpecifier": {
                                "type": "IntervalTypeSpecifier",
                                "pointType": {
                                    "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                    "type": "NamedTypeSpecifier"
                                }
                            }
                        },
                        {
                            "name": "coveringIntervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "DateTime Interval Gaps Relative to Base Interval Stats",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "Query",
                        "source": [
                            {
                                "alias": "variableDeclarations",
                                "expression": {
                                    "type": "Tuple",
                                    "element": [
                                        {
                                            "name": "Gap Intervals",
                                            "value": {
                                                "name": "DateTime Interval Gaps Relative to Base Interval",
                                                "type": "FunctionRef",
                                                "operand": [
                                                    {
                                                        "name": "baseInterval",
                                                        "type": "OperandRef"
                                                    },
                                                    {
                                                        "name": "coveringIntervals",
                                                        "type": "OperandRef"
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ],
                        "relationship": [],
                        "return": {
                            "expression": {
                                "name": "Collapsed DateTime Interval Stats",
                                "type": "FunctionRef",
                                "operand": [
                                    {
                                        "path": "Gap Intervals",
                                        "scope": "variableDeclarations",
                                        "type": "Property"
                                    }
                                ]
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "baseInterval",
                            "operandTypeSpecifier": {
                                "type": "IntervalTypeSpecifier",
                                "pointType": {
                                    "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                    "type": "NamedTypeSpecifier"
                                }
                            }
                        },
                        {
                            "name": "coveringIntervals",
                            "operandTypeSpecifier": {
                                "type": "ListTypeSpecifier",
                                "elementType": {
                                    "type": "IntervalTypeSpecifier",
                                    "pointType": {
                                        "name": "{urn:hl7-org:elm-types:r1}DateTime",
                                        "type": "NamedTypeSpecifier"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Convert To UTC DateTime",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "type": "Query",
                        "source": [
                            {
                                "alias": "i",
                                "expression": {
                                    "type": "Tuple",
                                    "element": [
                                        {
                                            "name": "StartYear",
                                            "value": {
                                                "precision": "Year",
                                                "type": "DateTimeComponentFrom",
                                                "operand": {
                                                    "name": "d",
                                                    "type": "OperandRef"
                                                }
                                            }
                                        },
                                        {
                                            "name": "StartMonth",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Month",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "name": "d",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Month",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "name": "d",
                                                        "type": "OperandRef"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "name": "StartDay",
                                            "value": {
                                                "type": "If",
                                                "condition": {
                                                    "type": "IsNull",
                                                    "operand": {
                                                        "precision": "Day",
                                                        "type": "DateTimeComponentFrom",
                                                        "operand": {
                                                            "name": "d",
                                                            "type": "OperandRef"
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                                    "value": "0",
                                                    "type": "Literal"
                                                },
                                                "else": {
                                                    "precision": "Day",
                                                    "type": "DateTimeComponentFrom",
                                                    "operand": {
                                                        "name": "d",
                                                        "type": "OperandRef"
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        ],
                        "relationship": [],
                        "return": {
                            "expression": {
                                "type": "DateTime",
                                "year": {
                                    "path": "StartYear",
                                    "scope": "i",
                                    "type": "Property"
                                },
                                "month": {
                                    "path": "StartMonth",
                                    "scope": "i",
                                    "type": "Property"
                                },
                                "day": {
                                    "path": "StartDay",
                                    "scope": "i",
                                    "type": "Property"
                                },
                                "hour": {
                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                    "value": "0",
                                    "type": "Literal"
                                },
                                "minute": {
                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                    "value": "0",
                                    "type": "Literal"
                                },
                                "second": {
                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                    "value": "0",
                                    "type": "Literal"
                                },
                                "millisecond": {
                                    "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                    "value": "0",
                                    "type": "Literal"
                                },
                                "timezoneOffset": {
                                    "type": "ToDecimal",
                                    "operand": {
                                        "valueType": "{urn:hl7-org:elm-types:r1}Integer",
                                        "value": "0",
                                        "type": "Literal"
                                    }
                                }
                            }
                        }
                    },
                    "operand": [
                        {
                            "name": "d",
                            "operandTypeSpecifier": {
                                "name": "{urn:hl7-org:elm-types:r1}Date",
                                "type": "NamedTypeSpecifier"
                            }
                        }
                    ]
                },
                {
                    "name": "Convert Interval Date to UTC Interval DateTime",
                    "context": "Patient",
                    "accessLevel": "Public",
                    "type": "FunctionDef",
                    "expression": {
                        "lowClosed": true,
                        "highClosed": true,
                        "type": "Interval",
                        "low": {
                            "name": "Convert To UTC DateTime",
                            "type": "FunctionRef",
                            "operand": [
                                {
                                    "type": "Start",
                                    "operand": {
                                        "name": "interval",
                                        "type": "OperandRef"
                                    }
                                }
                            ]
                        },
                        "high": {
                            "name": "Convert To UTC DateTime",
                            "type": "FunctionRef",
                            "operand": [
                                {
                                    "type": "End",
                                    "operand": {
                                        "name": "interval",
                                        "type": "OperandRef"
                                    }
                                }
                            ]
                        }
                    },
                    "operand": [
                        {
                            "name": "interval",
                            "operandTypeSpecifier": {
                                "type": "IntervalTypeSpecifier",
                                "pointType": {
                                    "name": "{urn:hl7-org:elm-types:r1}Date",
                                    "type": "NamedTypeSpecifier"
                                }
                            }
                        }
                    ]
                }
            ]
        }
    }
}